# 模組 6：訓練與測試

***

### **講座：第 11-12 週**

**授課者：** Dr. Cortex

**主題：** 自我進化：利用訓練流程實現 Agent 的持續優化

***

#### **1. 第一原理：從靜態模型到動態學習**

一個在部署後行為就固定不變的 AI 模型，是一個靜態的實體。它無法適應新的數據模式、無法從錯誤中學習，也無法根據特定任務進行微調。

這裡的**第一原理**是**適應性學習 (Adaptive Learning)**。一個真正智能的系統必須能夠利用其執行任務的經驗來**改進其自身的未來表現**。這種從經驗中學習的過程，是從一個固定的工具轉變為一個能夠持續進化的合作夥伴的關鍵。

---

#### **2. 基礎知識：CrewAI 的訓練機制**

CrewAI 內建了一套訓練流程，讓您可以對 Agent 的行為進行微調，使其更符合您的特定需求。這個過程的核心是利用**高品質的互動數據**來指導模型的學習。

##### **2.1 訓練流程概覽**

CrewAI 的訓練可以透過兩種方式啟動：
1.  **程式化接口**：在您的程式碼中調用 `crew.train()` 方法。
2.  **命令行界面 (CLI)**：使用 `crewai train` 命令。

無論哪種方式，其基本流程都是一致的：
1.  **數據收集**：收集一系列的「輸入-輸出」範例對。這些範例代表了您期望 Agent 如何回應特定任務的「黃金標準」。
2.  **模型微調**：CrewAI 會利用這些數據，對您為 Agent 指定的語言模型進行微調 (fine-tuning)。
3.  **性能提升**：微調後的模型在處理類似任務時，其輸出將更貼近您提供的範例，從而減少幻覺、提升一致性，並更好地遵循特定格式。

##### **2.2 `train_dataset.jsonl` 文件**

訓練數據需要以 `.jsonl` (JSON Lines) 格式提供。檔案中的每一行都是一個獨立的 JSON 物件，代表一個訓練範例。每個物件至少包含：
-   `"input"`: 一個範例任務的描述或輸入。
-   `"output"`: 對於該輸入，您期望的、理想的輸出。

```json
{"input": "撰寫一篇關於蘋果公司最新財報的摘要。", "output": "蘋果公司在 Q4 表現強勁，iPhone 銷售超出預期..."}
{"input": "將以下文字翻譯成法文：Hello, world!", "output": "Bonjour, le monde!"}
```

---

#### **3. 知識體系（BoK）：自我訓練管道 (Self-Training Pipeline)**

**定義：** 自我訓練管道是一種進階的、自動化的學習模式。它不再依賴手動創建的數據集，而是利用 Agent **自身**在實際執行任務時產生的**高質量輸出**，來作為未來訓練的數據。

這是一個強大的自舉 (bootstrapping) 概念：**Agent 的成功經驗，成為了讓它未來更成功的養分。**

##### **實現方式：結合 Reflection Pattern**

我們可以利用在前面模組中學到的模式，來創建一個自我訓練的閉環：

1.  **任務執行與記錄**：設置一個常規的 Crew（例如，一個包含 `Planner`, `Executor`, `Reviewer` 的層級式 Crew）來執行真實世界的任務。**關鍵**：將所有成功的、經過 `Reviewer` 高度評價的最終輸出，連同其原始輸入，記錄到一個日誌檔案中。

2.  **數據篩選與格式化**：定期運行一個腳本，該腳本會：
    -   讀取日誌檔案。
    -   篩選出被評為高品質的互動（例如，`Reviewer` 評分 > 8 的項目）。
    -   將這些高品質的「輸入-輸出」對，轉換為 `train_dataset.jsonl` 格式。

3.  **自動化訓練**：設置一個定期的、自動化的任務（例如，每週一次的 cron job），該任務會執行 `crewai train` 命令，利用新生成的 `train_dataset.jsonl` 文件來對您的 Agent 模型進行增量微調。

4.  **模型部署**：將微調後的新模型部署到您的生產環境中，以取代舊模型。

透過這個管道，您的 Agent 會隨著時間的推移，不斷地從其自身的最佳實踐中學習，變得越來越專業、越來越可靠。

---

#### **4. 實驗室指引：實驗 6**

請參閱 `lab/lab_6.md`。您將：
1.  手動創建一個小型的 `train_dataset.jsonl` 文件，其中包含幾個您希望 Agent 學習的特定問答風格或格式的範例。
2.  使用 `crew.train()` 方法來對一個 Agent 進行訓練。
3.  在訓練前後，分別用相同的任務提示來測試該 Agent，並比較其輸出的差異，以驗證訓練的效果。
4.  (挑戰) 嘗試實現上述的自我訓練管道的簡化版本：修改您在前面實驗中創建的 Crew，使其在完成後，將高品質的結果自動附加到一個 `.jsonl` 檔案中。

本實驗將為您揭開 AI 模型「學習」的神秘面紗，讓您從一個模型的使用者，轉變為一個能夠塑造和優化模型的訓練者。

講座結束。



