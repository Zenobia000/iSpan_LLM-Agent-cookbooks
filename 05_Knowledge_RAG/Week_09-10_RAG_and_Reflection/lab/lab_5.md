# 實驗 5：利用 RAG 和 Guardrails 建立領域專家

## 第一部分：運行並分析基礎範例

1.  **導航至範例目錄：**
    ```bash
    cd ../examples/rag_self_correction
    ```
2.  **執行腳本：**
    ```bash
    python main.py
    ```
3.  **分析輸出：**
    -   仔細觀察 `verbose=2` 的日誌。您應該會看到任務被執行了兩次。
    -   **第一次嘗試**：分析 Agent 第一次嘗試的思考過程。它很可能會調用 `Knowledge Base Search` 工具，並以「personal leave」作為查詢。當找不到結果時，它的最終答案是什麼？
    -   **Guardrail 的作用**：日誌中會明確顯示 `guardrail` 觸發失敗。
    -   **第二次嘗試**：分析 Agent 第二次嘗試的思考過程。它現在知道必須找到包含「annual leave」的資訊。觀察它是如何改變其策略來達成這個目標的。它是否使用了不同的搜索查詢？

## 第二部分：擴展您的知識庫

1.  **編輯知識庫文件**：
    -   打開 `company_policy.md` 檔案。
    -   在現有內容下方，新增一個關於「遠程工作 (Remote Work)」的章節。內容可以自訂，但要包含一些關鍵細節。例如：
        ```markdown
        ## 遠程工作政策
        員工每週最多可以申請兩天遠程工作。申請必須提前一週透過 HR 系統提交。所有遠程工作的員工必須確保其家庭網路連線穩定。
        ```
2.  **創建一個新任務**：
    -   在 `main.py` 中，創建一個新的 `Task`，名為 `remote_work_task`。
    -   `description` 應該是一個關於遠程工作申請流程的問題，例如：「我想申請下週在家工作，我需要做什麼？」
    -   `expected_output` 應該是申請流程的清晰說明。
3.  **為新任務設計一個 Guardrail**：
    -   為 `remote_work_task` 添加一個 `guardrail`。這個護欄應該驗證答案是否提到了申請的具體要求，例如，檢查輸出中是否包含「提前一週」或「HR 系統」等關鍵字。
4.  **修改您的 Crew**：
    -   更新 `policy_crew` 的 `tasks` 列表，使其執行您的新 `remote_work_task`。
    -   運行腳本並驗證您的新任務和 `guardrail` 是否按預期工作。

## 第三部分：(挑戰) 處理不相關的查詢

一個好的 RAG 系統不僅要能找到相關資訊，還要能識別出何時**沒有**相關資訊。

1.  **創建一個不相關的任務**：
    -   創建第三個任務，`unrelated_task`。其 `description` 應該是一個與公司政策完全無關的問題，例如：「這週末的天氣如何？」
2.  **移除 Guardrail**：
    -   在這個新任務上，**不要**使用 `guardrail`。
3.  **運行並觀察 Agent 的行為**：
    -   `PolicyExpert` Agent 將如何回應這個問題？它會嘗試在知識庫中搜索嗎？它會承認它不知道答案，還是會產生幻覺（即編造一個答案）？
4.  **思考與改進**：
    -   您該如何修改 Agent 的 `role`, `goal`, 或 `backstory` 來讓它在遇到其知識庫無法回答的問題時，能夠更優雅地回應（例如，明確地說「根據我所擁有的公司政策文件，我無法回答關於天氣的問題」）？請嘗試修改並測試您的想法。

這個挑戰將幫助您理解為 Agent 設定正確的行為邊界和期望的重要性，這是構建可靠 AI 系統的關鍵一環。



